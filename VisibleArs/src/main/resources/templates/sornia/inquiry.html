<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>주문조회</title>
	<link rel="stylesheet" th:href="@{/sornia/css/font.css}" />
	<link rel="stylesheet" th:href="@{/sornia/css/reset.css}" />
	<link rel="stylesheet" th:href="@{/sornia/css/ui.css}" />
	<link rel="stylesheet" th:href="@{/sornia/css/common.css}" />
	<link rel="stylesheet" th:href="@{/sornia/css/inquiry.css}" />
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
	<header class="page-header">
		<div class="left-area">
			<img src="/sornia/assets/ico_headphone_w.svg" alt="headphone" class="icon" />
			<span class="title">보이는 ARS</span>
		</div>
		<div class="right-area">
			<div class="button" onclick="handleClickClose()">
				<img src="/sornia/assets/ico_close_w.svg" alt="headphone" class="icon" />
				<span class="title">닫기</span>
			</div>
		</div>
	</header>
	<div class="page-container">
		<div class="content">
			<div class="header">
				<img src="/sornia/assets/ico_inquiry_2.svg" alt="inquiry" />
				<p class="title">1:1 문의하기</p>
				<p class="description">상담원에게 문의하실 내용을 적어주세요.</p>
			</div>
			<div class="ui-data-table">
				<input type="hidden" id="order_no_shop" th:value="${order_no_shop}"/>
				<input type="hidden" id="orderno" />
				<input type="hidden" id="userid" />
				<table>
					<colgroup>
						<col width="65px" />
						<col width="*" />
					</colgroup>
					<tbody>
						<tr>
							<th>이 름</th>
							<td>
								<div class="ui-text-field">														
									<input type="text" id="orderer_name" th:value="${orderer_name}" placeholder="예 : 홍길동" />
								</div>
							</td>
						</tr>
						<tr>
							<th>전 화 번 호</th>
							<td>
								<div class="ui-text-field">
									<input type="text" id="orderer_phone1"  th:value="${orderer_phone1}" placeholder="예 : 010-0000-0000" />
								</div>
							</td>
						</tr>
						<tr>
							<th>문의 구분</th>
							<td>
								<select>
									<option>1</option>
									<option>1</option>
									<option>1</option>
								</select>
							</td>
						</tr>						
						<tr>
							<th>제 목</th>
							<td>
								<div class="ui-text-field">
									<input type="text" id="title" placeholder="제목을 입력해주세요." />
								</div>
							</td>
						</tr>
						<tr>
							<td colspan="2" class="non-padding">
								<div class="ui-textarea">
									<textarea name="content" id="content"
										placeholder="교환 및 반품 사유를 간략하게 기재해주세요."></textarea>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="files">
				<div class="header">
					<span class="title">파일첨부</span>
					<span class="description">* 5개까지 업로드가 가능합니다.</span>
				</div>
				<div class="preview">
					<ul id="imglistul">
					</ul>
				</div>
				<div class="controller">
					<label for="files">
						<div class="ui-button default">
							<span class="title">파일등록하기</span>
							<input type="file" multiple id="files" name="files" />
							<img src="/sornia/assets/ico_upload.svg" alt="upload" />
						</div>
					</label>
				</div>
			</div>
			<div class="inquiry">
				<a href="#">
					<div onclick="uploadimg()" class="ui-button blue">
						<span class="title">등록하기</span>
					</div>
				</a>
			</div>
		</div>
	</div>
	<div>

		<!-- notice -->
		<div class="notice" id="notice">
			<p>3G, LTE, 5G 환경에서는 데이터 요금이 발생합니다.</p>
			<img src="/sornia/assets/ico_smart_cti.svg" alt="smart_cti" />
		</div>
</body>

<script>
	
	// 이미지 정보들을 담을 배열
	var sel_files = [];
	
	$(document).ready(function () {
		$("#files").on("change", SelectImg);
		/*
		if($("#orderer_phone1").val()!=""){
			$("#orderer_phone1").attr("readonly",true);
		}
		
		if($("#orderer_name").val()!=""){
			$("#orderer_name").attr("readonly",true);
		}
		*/
	});


	const fileElement = document.querySelector('#files');
	fileElement.onchange = function () {
		// file upload logic.
	};

	window.onload = function () {
		const scrollHeight = document.scrollingElement.scrollHeight;
		const noticeElement = document.querySelector('#notice');
		noticeElement.style.top = `${scrollHeight - 100}px`;
	};

	function handleClickClose() {
		// when clicked close icon.
	}

	//업로드 여러개 하기
	function uploadimg() {

		if (sel_files.length === 0) {
			alert("파일은 선택해주세요");
			return;
		}

		const formData = new FormData();

		for (var i = 0; i < sel_files.length; i++) {
			formData.append("file", sel_files[i]);
		}
		formData.append("order_no_shop",$("#order_no_shop").val());
		formData.append("title",$("#title").val());
		formData.append("content",$("#content").val());
		
		formData.append("orderer_phone1",$("#orderer_phone1").val());
		formData.append("orderer_name",$("#orderer_name").val());
		
		$.ajax({
			type: 'POST',
			url: "/sornia/uploadimglist",
			data: formData,
			cache: false,
			contentType: false,
			processData: false,
			enctype: 'multipart/form-data'
		}).done(function (data) {
			$('#result-image').attr("src", data);
		}).fail(function (error) {
			console.log(error);
		})
	}

	function SelectImg(e) {

		// 이미지 정보들을 초기화
		sel_files = [];
		$("#imglistul").empty();

		var files = e.target.files;
		var filesArr = Array.prototype.slice.call(files);

		var index = 0;
		filesArr.forEach(function (f) {
			sel_files.push(f);
			var reader = new FileReader();
			reader.onload = function (e) {
				//var html = '<li img src="'+e.target.result+'" class="image"><img src="/sornia/assets/ico_cancel.svg" alt="cancel" class="cancel" /></li>';
				var html = '<img src="' + e.target.result + '" style="width: 45px; height: 45px; margin-right: 20px;" /><img src="/sornia/assets/ico_cancel.svg" alt="cancel" style="  position: absolute;  top: 0;  right: -8px;  width: 5px;  height: auto;" />';
				$("#imglistul").append(html);
				index++;
			}
			reader.readAsDataURL(f);

		});
	}

	function deleteImageAction(index) {
		console.log("index : " + index);
		sel_files.splice(index, 1);

		var img_id = "#img_id_" + index;
		$(img_id).remove();

		console.log(sel_files);
	}   
	
		
	//업로드 한개
	/*
	function upload() {
	  const imageInput = $("#imageInput")[0];
	  // 파일을 여러개 선택할 수 있으므로 files 라는 객체에 담긴다.
	  console.log("imageInput: ", imageInput.files)
	
	  if(imageInput.files.length === 0){
		alert("파일은 선택해주세요");
		return;
	  }
	
	  const formData = new FormData();
	  formData.append("file", imageInput.files[0]);
	
		$.ajax({
			type: 'POST',
			url: "/sornia/uploadimg",
			data: formData,
			cache: false,
			contentType: false,
			processData: false,
			enctype: 'multipart/form-data'
		}).done(function (data) {
			$('#result-image').attr("src", data);
		}).fail(function (error) {
			console.log(error);
		})
	}
	*/

</script>

</script>

</html>